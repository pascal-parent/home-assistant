title: "Electricity"
path: "electricity"

cards:
  - type: vertical-stack
    cards:
      - type: horizontal-stack
        cards:
          - type: "custom:button-card"
            template: chip_back
            variables:
              ulm_chip_back_path: home

          - type: "custom:button-card"
            template: custom_card_title
            name: "Energy"

          - type: "custom:button-card"
            color_type: blank-card

          - type: "custom:button-card"
            template: custom_chip_mdi_text_icon_state
            variables:
              ulm_chip_mdi_icon_state_entity: sensor.loadshedding_national_status
              ulm_chip_mdi_icon_state_icon: mdi:transmission-tower
              ulm_chip_mdi_icon_state_text: Stage

      # ----------------------------------------------------------------------------
      # Electricity consumption
      # ----------------------------------------------------------------------------

      - type: custom:power-flow-card
        title: Overview
        kw_decimals: 2
        entities:
          battery: sensor.ss_battery_power
          battery_charge: sensor.ss_battery_soc
          grid:
            consumption: sensor.ss_grid_power
          solar: sensor.ss_pv1_power
          #inverted_entities: grid

      # ----------------------------------------------------------------------------
      # Load shedding and power issues
      # ----------------------------------------------------------------------------
      - type: conditional
        conditions:
          - entity: sensor.loadshedding_local_status_currently_loadshedding
            state_not: "True"
        card:
          type: horizontal-stack
          cards:
            - type: tile
              name: Next power outage is from
              entity: sensor.next_loadshedding_scheduled_time
              icon: mdi:transmission-tower-off
              color: white

      - type: conditional
        conditions:
          - entity: sensor.loadshedding_local_status_currently_loadshedding
            state: "True"
          - entity: binary_sensor.house_power
            state: "unavailable"
        card:
          type: horizontal-stack
          cards:
            - type: tile
              name: "Currently load shedding until"
              entity: sensor.current_loadshedding_end_time
              icon: mdi:power-plug-off
              color: red

      - type: conditional
        conditions:
          - entity: sensor.loadshedding_local_status_currently_loadshedding
            state: "False"
          - entity: binary_sensor.house_power
            state: "unavailable"
        card:
          type: horizontal-stack
          cards:
            - type: tile
              name: "Power Failure in progress"
              entity: sensor.power_usage
              icon: mdi:power-plug-off
              color: red

      # ----------------------------------------------------------------------------
      # Manual Grid Charge
      # ----------------------------------------------------------------------------

      - type: horizontal-stack
        cards:
          - type: "custom:button-card"
            template: card_script
            variables:
              ulm_card_script_title: Charge Batteries On
              ulm_card_script_icon: "mdi:power-plug-battery"
            tap_action:
              action: call-service
              service: automation.trigger
              service_data:
                entity_id: automation.automated_battery_charging

          - type: "custom:button-card"
            template: card_script
            variables:
              ulm_card_script_title: Charge Batteries Off
              ulm_card_script_icon: "mdi:power-plug-battery-outline"
            tap_action:
              action: call-service
              service: automation.trigger
              service_data:
                entity_id: automation.automated_battery_charging_off

      - type: "custom:button-card"
        template: card_generic
        entity: sensor.agregated_power_usage
        variables:
          ulm_card_generic_name: Monitored appliances current draw
          ulm_card_generic_icon: mdi:gauge-low

      - type: horizontal-stack
        cards:
          - type: custom:flex-horseshoe-card
            entities:
              - entity: sensor.ss_pv1_power
                decimals: 0
                unit: W
                name: Solar
              - entity: sensor.ss_pv1_power
                decimals: 0
                unit: W
                name: PV1
              - entity: sensor.ss_pv1_power
                decimals: 0
                unit: W
                name: PV2
              - entity: sensor.ss_pv1_voltage
                decimals: 0
                unit: V
              - entity: sensor.ss_pv1_voltage
                decimals: 0
                unit: V
              - entity: sensor.ss_pv1_current
                decimals: 1
                unit: A
              - entity: sensor.ss_pv1_current
                decimals: 1
                unit: A
              - entity: sensor.ss_day_pv_energy
                decimals: 2
                unit: kWh
                name: Daily
              - entity: sensor.energy_production_today_remaining
                decimals: 2
                unit: kWh
                name: Left Today
            show:
              horseshoe_style: colorstop
            layout:
              hlines:
                - id: 0
                  xpos: 50
                  ypos: 40
                  length: 70
                  styles:
                    - opacity: 0.2;
              vlines:
                - id: 0
                  xpos: 50
                  ypos: 59
                  length: 36
                  styles:
                    - opacity: 0.2;
              states:
                - id: 0
                  entity_index: 0
                  xpos: 50
                  ypos: 33
                  styles:
                    - font-size: 3em;
                    - opacity: 0.9;
                - id: 1
                  entity_index: 1
                  xpos: 47
                  ypos: 53
                  styles:
                    - font-size: 1.5em;
                    - text-anchor: end;
                - id: 2
                  entity_index: 2
                  xpos: 53
                  ypos: 53
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 3
                  entity_index: 3
                  xpos: 46
                  ypos: 63
                  styles:
                    - text-anchor: end;
                    - font-size: 1.5em;
                - id: 4
                  entity_index: 4
                  xpos: 53
                  ypos: 63
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 5
                  entity_index: 5
                  xpos: 46
                  ypos: 73
                  styles:
                    - text-anchor: end;
                    - font-size: 1.5em;
                - id: 6
                  entity_index: 6
                  xpos: 53
                  ypos: 73
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 7
                  entity_index: 7
                  xpos: 0
                  ypos: 7
                  styles:
                    - text-anchor: start;
                    - font-size: 1.2em;
                - id: 8
                  entity_index: 8
                  xpos: 100
                  ypos: 7
                  styles:
                    - text-anchor: end;
                    - font-size: 1.2em;
              icons:
                - id: 0
                  entity_index: 1
                  xpos: 1
                  ypos: 53
                  align: start
                  size: 1
                - id: 1
                  entity_index: 2
                  xpos: 53
                  ypos: 65
                  align: end
                  size: 0.5
              names:
                - id: 0
                  entity_index: 0
                  xpos: 50
                  ypos: 95
                  styles:
                    - font-size: 1.2em;
                - id: 1
                  entity_index: 1
                  xpos: 15
                  ypos: 45
                  styles:
                    - text-anchor: start;
                    - font-size: 0.5em;
                - id: 2
                  entity_index: 2
                  xpos: 85
                  ypos: 45
                  styles:
                    - text-anchor: end;
                    - font-size: 0.5em;
                - id: 3
                  entity_index: 7
                  xpos: 0
                  ypos: 12
                  styles:
                    - text-anchor: start;
                    - font-size: 0.5em;
                - id: 4
                  entity_index: 8
                  xpos: 100
                  ypos: 12
                  styles:
                    - font-size: 0.5em;
                    - text-anchor: end;
            horseshoe_scale:
              min: 0
              max: 4000
              width: 6
            color_stops:
              0: "#9E0000"
              800: "#FFA81D"
              1800: "#228127"

          - type: custom:flex-horseshoe-card
            entities:
              - entity: sensor.ss_battery_soc
                decimals: 0
                unit: "%"
                name: BATTERY
              - entity: sensor.ss_battery_voltage
                decimals: 2
                unit: V
              - entity: sensor.ss_battery_current
                decimals: 2
                unit: A
              - entity: sensor.ss_battery_power
                decimals: 0
                unit: W
              - entity: sensor.ss_day_battery_discharge
                decimals: 2
                unit: kWh
                name: Discharge
              - entity: sensor.ss_day_battery_charge
                decimals: 2
                unit: kWh
                name: Charge
            show:
              horseshoe_style: colorstop
            layout:
              hlines:
                - id: 0
                  xpos: 50
                  ypos: 40
                  length: 70
                  styles:
                    - opacity: 0.2;
                - id: 0
                  xpos: 50
                  ypos: 60
                  length: 70
                  styles:
                    - opacity: 0.2;
              vlines:
                - id: 0
                  xpos: 50
                  ypos: 50
                  length: 18
                  styles:
                    - opacity: 0.2;
              states:
                - id: 0
                  entity_index: 0
                  xpos: 50
                  ypos: 33
                  styles:
                    - font-size: 3em;
                    - opacity: 0.9;
                - id: 1
                  entity_index: 1
                  xpos: 44
                  ypos: 53
                  styles:
                    - font-size: 1.5em;
                    - text-anchor: end;
                - id: 2
                  entity_index: 2
                  xpos: 55
                  ypos: 53
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 3
                  entity_index: 3
                  xpos: 50
                  ypos: 75
                  styles:
                    - font-size: 2em;
                - id: 4
                  entity_index: 4
                  xpos: 100
                  ypos: 7
                  styles:
                    - text-anchor: end;
                    - font-size: 1.2em;
                - id: 5
                  entity_index: 5
                  xpos: 0
                  ypos: 7
                  styles:
                    - text-anchor: start;
                    - font-size: 1.2em;
              icons:
                - id: 0
                  entity_index: 1
                  xpos: 30
                  ypos: 52
                  align: start
                  size: 1
              names:
                - id: 0
                  entity_index: 0
                  xpos: 50
                  ypos: 95
                  styles:
                    - font-size: 1.2em;
                - id: 1
                  entity_index: 4
                  xpos: 100
                  ypos: 12
                  styles:
                    - font-size: 0.5em;
                    - text-anchor: end;
                - id: 2
                  entity_index: 5
                  xpos: 0
                  ypos: 12
                  styles:
                    - font-size: 0.5em;
                    - text-anchor: start;
            horseshoe_scale:
              min: 0
              max: 100
              width: 6
            color_stops:
              0: "#9E0000"
              20: "#FFA81D"
              40: "#228127"

      - type: horizontal-stack
        cards:
          - type: custom:flex-horseshoe-card
            entities:
              - entity: sensor.ss_grid_power
                decimals: 0
                unit: W
                name: AC
              - entity: sensor.ss_grid_power
                decimals: 0
                unit: W
                name: Import
              - entity: sensor.power_usage #replace with power_usage - ss_grid_power
                decimals: 0
                unit: W
                name: Grid
              - entity: sensor.ss_grid_voltage
                decimals: 0
                unit: V
              - entity: sensor.ss_grid_voltage
                decimals: 0
                unit: V
              - entity: sensor.ss_grid_current
                decimals: 1
                unit: A
              - entity: sensor.ss_non_essential_power #replace with calculated amps from wattage
                decimals: 1
                unit: A
              - entity: sensor.daily_consumption
                decimals: 2
                unit: kWh
                name: Daily
              - entity: sensor.ss_day_grid_import
                decimals: 2
                unit: kWh
                name: Import
            show:
              horseshoe_style: colorstop
            layout:
              hlines:
                - id: 0
                  xpos: 50
                  ypos: 40
                  length: 70
                  styles:
                    - opacity: 0.2;
              vlines:
                - id: 0
                  xpos: 50
                  ypos: 59
                  length: 36
                  styles:
                    - opacity: 0.2;
              states:
                - id: 0
                  entity_index: 0
                  xpos: 50
                  ypos: 33
                  styles:
                    - font-size: 3em;
                    - opacity: 0.9;
                - id: 1
                  entity_index: 1
                  xpos: 47
                  ypos: 53
                  styles:
                    - font-size: 1.5em;
                    - text-anchor: end;
                - id: 2
                  entity_index: 2
                  xpos: 53
                  ypos: 53
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 3
                  entity_index: 3
                  xpos: 46
                  ypos: 63
                  styles:
                    - text-anchor: end;
                    - font-size: 1.5em;
                - id: 4
                  entity_index: 4
                  xpos: 53
                  ypos: 63
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 5
                  entity_index: 5
                  xpos: 46
                  ypos: 73
                  styles:
                    - text-anchor: end;
                    - font-size: 1.5em;
                - id: 6
                  entity_index: 6
                  xpos: 53
                  ypos: 73
                  styles:
                    - text-anchor: start;
                    - font-size: 1.5em;
                - id: 7
                  entity_index: 7
                  xpos: 0
                  ypos: 7
                  styles:
                    - text-anchor: start;
                    - font-size: 1.2em;
                - id: 8
                  entity_index: 8
                  xpos: 100
                  ypos: 7
                  styles:
                    - text-anchor: end;
                    - font-size: 1.2em;
              icons:
                - id: 0
                  entity_index: 1
                  xpos: 1
                  ypos: 53
                  align: start
                  size: 1
                - id: 1
                  entity_index: 2
                  xpos: 53
                  ypos: 65
                  align: end
                  size: 0.5
              names:
                - id: 0
                  entity_index: 0
                  xpos: 50
                  ypos: 95
                  styles:
                    - font-size: 1.2em;
                - id: 1
                  entity_index: 1
                  xpos: 15
                  ypos: 45
                  styles:
                    - text-anchor: start;
                    - font-size: 0.5em;
                - id: 2
                  entity_index: 2
                  xpos: 85
                  ypos: 45
                  styles:
                    - text-anchor: end;
                    - font-size: 0.5em;
                - id: 3
                  entity_index: 7
                  xpos: 0
                  ypos: 12
                  styles:
                    - text-anchor: start;
                    - font-size: 0.5em;
                - id: 4
                  entity_index: 8
                  xpos: 100
                  ypos: 12
                  styles:
                    - font-size: 0.5em;
                    - text-anchor: end;
            horseshoe_scale:
              min: 0
              max: 8000
              width: 6
            color_stops:
              0: "#228127"
              100: "#FFA81D"
              600: "#9E0000"

          - type: "custom:button-card"
            color_type: blank-card

  - type: vertical-stack
    cards:
      # ----------------------------------------------------------------------------
      # Kitchen
      # ----------------------------------------------------------------------------
      - type: "custom:button-card"
        template: card_title
        label: "Kitchen"

      - type: horizontal-stack
        cards:
          #Fridge
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.shelly_fridge_power
            variables:
              ulm_card_graph_icon: mdi:fridge-variant
              ulm_card_graph_color: "var(--google-blue)"
              ulm_card_graph_name: Fridge
              ulm_card_graph_entity: sensor.shelly_fridge_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          #Dishwasher
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.shelly_dishwasher_power
            variables:
              ulm_card_graph_icon: mdi:dishwasher
              ulm_card_graph_color: "var(--google-red)"
              ulm_card_graph_name: Dishwasher
              ulm_card_graph_entity: sensor.shelly_dishwasher_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

      - type: horizontal-stack
        cards:
          #Kettle
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.shelly_kitchen_kettle_plug_power
            variables:
              ulm_card_graph_icon: mdi:kettle-outline
              ulm_card_graph_color: "var(--google-green)"
              ulm_card_graph_name: Kettle Plug
              ulm_card_graph_entity: sensor.shelly_kitchen_kettle_plug_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          #Microwave Oven
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.microwave_power
            variables:
              ulm_card_graph_icon: mdi:microwave
              ulm_card_graph_color: "#FFFFFF"
              ulm_card_graph_name: Microwave Oven
              ulm_card_graph_entity: sensor.microwave_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

      - type: horizontal-stack
        cards:
          #Toaster
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.shelly_kitchen_multi_plug_power
            variables:
              ulm_card_graph_icon: mdi:toaster
              ulm_card_graph_color: "var(--google-green)"
              ulm_card_graph_name: Toaster
              ulm_card_graph_entity: sensor.shelly_kitchen_multi_plug_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          - type: "custom:button-card"
            color_type: blank-card

      # ----------------------------------------------------------------------------
      # Office
      # ----------------------------------------------------------------------------

      - type: "custom:button-card"
        template: card_title
        label: "Office"

      - type: horizontal-stack
        cards:
          #Pascal's Desk Plug
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.pascals_desk_power
            variables:
              ulm_card_graph_icon: mdi:desk
              ulm_card_graph_color: "var(--google-blue)"
              ulm_card_graph_name: Pascal's Desk Plug
              ulm_card_graph_entity: sensor.pascals_desk_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          - type: "custom:button-card"
            color_type: blank-card

      # ----------------------------------------------------------------------------
      # TV Room
      # ----------------------------------------------------------------------------
      - type: "custom:button-card"
        template: card_title
        label: "TV Room"

      - type: horizontal-stack
        cards:
          #Toaster
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.shelly_upstair_s_tv_plug_power
            variables:
              ulm_card_graph_icon: mdi:television
              ulm_card_graph_color: "var(--google-green)"
              ulm_card_graph_name: TV (24h)
              ulm_card_graph_entity: sensor.shelly_upstair_s_tv_plug_energy
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          - type: "custom:button-card"
            color_type: blank-card

      # ----------------------------------------------------------------------------
      # Garage
      # ----------------------------------------------------------------------------
      - type: "custom:button-card"
        template: card_title
        label: "Garage"

      - type: horizontal-stack
        cards:
          #Whashing Machine
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.shelly_washing_machine_energy
            variables:
              ulm_card_graph_icon: mdi:washing-machine
              ulm_card_graph_color: "var(--google-blue)"
              ulm_card_graph_name: Washing Machine
              ulm_card_graph_entity: sensor.shelly_washing_machine_energy
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          #3D Printer
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.3d_printer_power
            variables:
              ulm_card_graph_icon: mdi:printer-3d
              ulm_card_graph_color: "var(--google-red)"
              ulm_card_graph_name: 3D Printer
              ulm_card_graph_entity: sensor.3d_printer_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

      # ----------------------------------------------------------------------------
      # House
      # ----------------------------------------------------------------------------

      - type: "custom:button-card"
        template: card_title
        label: "House"

      - type: horizontal-stack
        cards:
          #Solar Geyser
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.solar_geyser_switch_power
            variables:
              ulm_card_graph_icon: mdi:storage-tank-outline
              ulm_card_graph_color: "var(--google-blue)"
              ulm_card_graph_name: Solar Geyser
              ulm_card_graph_entity: sensor.solar_geyser_switch_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

          #Inverter Grid Usage
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.ss_grid_power
            variables:
              ulm_card_graph_icon: mdi:transmission-tower
              ulm_card_graph_color: "var(--google-red)"
              ulm_card_graph_name: Inverter Grid Usage
              ulm_card_graph_entity: sensor.ss_grid_power
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
              ulm_card_graph_group_by: interval

  - type: vertical-stack
    cards:
      - type: "custom:button-card"
        template: card_title
        name: "Last 24 Hours"

      - type: "custom:button-card"
        template: custom_card_damix48_power_details
        entity: sensor.ss_pv1_power
        variables:
          ulm_card_power_details_name: Solar Pannels
          ulm_card_power_details_entity: sensor.ss_pv1_power
          ulm_card_power_details_hours: 24
          ulm_card_power_details_24hour: true
          ulm_card_power_details_thresholds:
            - value: 0
              color: "#DB4437"
            - value: 1000
              color: "#FFA600"
            - value: 2000
              color: "#43A047"

      - type: "custom:button-card"
        template: custom_card_damix48_power_details
        entity: sensor.ss_essential_power
        variables:
          ulm_card_power_details_name: Inverter Output
          ulm_card_power_details_entity: sensor.ss_essential_power
          ulm_card_power_details_hours: 24
          ulm_card_power_details_24hour: true
          ulm_card_power_details_thresholds:
            - value: 0
              color: "#43A047"
            - value: 1000
              color: "#FFA600"
            - value: 2000
              color: "#DB4437"

      - type: "custom:button-card"
        template: custom_card_damix48_power_details
        entity: sensor.ss_battery_power
        variables:
          ulm_card_power_details_name: Battery Power
          ulm_card_power_details_entity: sensor.ss_battery_power
          ulm_card_power_details_hours: 24
          ulm_card_power_details_24hour: true
          ulm_card_power_details_thresholds:
            - value: -100
              color: "#43A047"
            - value: 0
              color: "#80A1d4"
            - value: 100
              color: "#FFA600"
            - value: 1000
              color: "#DB4437"

      - type: "custom:button-card"
        template: custom_card_damix48_power_details
        entity: sensor.ss_grid_power
        variables:
          ulm_card_power_details_name: Inverter Grid Power Usage
          ulm_card_power_details_entity: sensor.ss_grid_power
          ulm_card_power_details_hours: 24
          ulm_card_power_details_24hour: true
          ulm_card_power_details_thresholds:
            - value: 550
              color: "#43A047"
            - value: 100
              color: "#FFA600"
            - value: 500
              color: "#DB4437"

  - type: vertical-stack
    cards:
      - type: "custom:button-card"
        template: custom_card_damix48_power_details
        entity: sensor.custom_power_usage
        variables:
          ulm_card_power_details_name: Total Grid Power Usage
          ulm_card_power_details_entity: sensor.custom_power_usage
          ulm_card_power_details_hours: 24
          ulm_card_power_details_24hour: true
          ulm_card_power_details_thresholds:
            - value: 0
              color: "#43A047"
            - value: 1000
              color: "#FFA600"
            - value: 2000
              color: "#DB4437"

      - type: "custom:button-card"
        template: card_title
        name: "Monthly"

      - type: entities
        entities:
          - entity: sensor.monthly_consumption
          - entity: sensor.monthly_energy_cost
          - entity: sensor.co2_signal_co2_intensity
